
# Metasploitable: Targetting Port 80

UMGC Pentesting class 

## Objectives: 
1. In redteam folder > student folder > get contents of mypass.txt
2. Get student password hash and crack it using JtR or other tool

## Target Port 80, http

### Scan target host using nmap

I'm scanning using msfconsole db_nmap, but regular nmap is fine. 

```
nmap -p 80 -T4 -A -v <ipaddress>
```

Result:
```bash
msf5 > db_nmap -p 80 -T4 -A -v 10.2.2.100
[*] Nmap: Starting Nmap 7.70 ( https://nmap.org ) at 2023-09-23 11:07 EDT
[*] Nmap: NSE: Loaded 148 scripts for scanning.
<snipped for brevity>
[*] Nmap: Completed NSE at 11:08, 0.00s elapsed
[*] Nmap: Nmap scan report for 10.2.2.100
[*] Nmap: Host is up (0.00034s latency).
[*] Nmap: PORT   STATE SERVICE VERSION
[*] Nmap: 80/tcp open  http    Apache httpd 2.2.8 ((Ubuntu) DAV/2)
[*] Nmap: | http-methods:
[*] Nmap: |_  Supported Methods: GET HEAD POST OPTIONS
[*] Nmap: |_http-server-header: Apache/2.2.8 (Ubuntu) DAV/2
[*] Nmap: |_http-title: Metasploitable2 - Linux
[*] Nmap: MAC Address: 00:0C:29:30:E1:15 (VMware)
<snipped>
[*] Nmap: OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
[*] Nmap: Nmap done: 1 IP address (1 host up) scanned in 21.32 seconds
[*] Nmap: Raw packets sent: 21 (1.670KB) | Rcvd: 17 (1.382KB)
msf5 > 

```
And as we can see, the target machine is hosting a webserver: 

![webserver](image-2.png)

### Targetting WebDAV

WebDAV (Web-based Distributed Authoring and Versioning) is an extension to the HTTP protocol that enables collaborative editing and remote management of files on web servers. It allows users to create, modify, and delete files and directories on a web server, making it useful for remote file access and management. However, WebDAV can introduce security vulnerabilities if not configured and secured properly. Some common attack vulnerabilities associated with WebDAV include unauthorized access, data leakage, and denial-of-service attacks. These vulnerabilities can be mitigated by implementing proper authentication, access controls, encryption, and regular security audits to ensure the safe and secure use of WebDAV in web applications and services.

First challenge is to find the a webDAV folder on the webserver and test if we can manipulate or view files on the server.

### Scanning for the webDAV folder

1. Nikto
2. davtest

**Nikto**

Nikto is an open-source web server scanner and vulnerability assessment tool designed to help identify security issues and vulnerabilities in web servers, web applications, and websites. It is widely used by security professionals, penetration testers, and system administrators to assess the security posture of web servers and web applications.

```bash
root@kali:~# nikto -h http://10.2.2.100
- Nikto v2.1.6
---------------------------------------------------------------------------
+ Target IP:          10.2.2.100
+ Target Hostname:    10.2.2.100
+ Target Port:        80
+ Start Time:         2023-09-23 12:01:36 (GMT-4)
---------------------------------------------------------------------------
+ Server: Apache/2.2.8 (Ubuntu) DAV/2
+ Retrieved x-powered-by header: PHP/5.2.4-2ubuntu5.10
+ The anti-clickjacking X-Frame-Options header is not present.
+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type
+ Apache/2.2.8 appears to be outdated (current is at least Apache/2.4.37). Apache 2.2.34 is the EOL for the 2.x branch.
+ Uncommon header 'tcn' found, with contents: list
+ Apache mod_negotiation is enabled with MultiViews, which allows attackers to easily brute force file names. See http://www.wisec.it/sectou.php?id=4698ebdc59d15. The following alternatives for 'index' were found: index.php
+ Web Server returns a valid response with junk HTTP methods, this may cause false positives.
+ OSVDB-877: HTTP TRACE method is active, suggesting the host is vulnerable to XST
+ /phpinfo.php: Output from the phpinfo() function was found.
+ OSVDB-3268: /doc/: Directory indexing found.
+ OSVDB-48: /doc/: The /doc/ directory is browsable. This may be /usr/doc.
+ OSVDB-12184: /?=PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.
+ OSVDB-12184: /?=PHPE9568F36-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.
+ OSVDB-12184: /?=PHPE9568F34-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.
+ OSVDB-12184: /?=PHPE9568F35-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.
+ OSVDB-3092: /phpMyAdmin/changelog.php: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.
+ Server may leak inodes via ETags, header found with file /phpMyAdmin/ChangeLog, inode: 92462, size: 40540, mtime: Tue Dec  9 12:24:00 2008
+ OSVDB-3092: /phpMyAdmin/ChangeLog: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.
+ OSVDB-3268: /test/: Directory indexing found.
+ OSVDB-3092: /test/: This might be interesting...
+ OSVDB-3233: /phpinfo.php: PHP is installed, and a test script which runs phpinfo() was found. This gives a lot of system information.
+ OSVDB-3268: /icons/: Directory indexing found.
+ OSVDB-3233: /icons/README: Apache default file found.
^_+ /phpMyAdmin/: phpMyAdmin directory found
+ OSVDB-3092: /phpMyAdmin/Documentation.html: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.
+ OSVDB-3092: /phpMyAdmin/README: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.
+ 8700 requests: 0 error(s) and 27 item(s) reported on remote host
+ End Time:           2023-09-23 12:01:53 (GMT-4) (17 seconds)
---------------------------------------------------------------------------
+ 1 host(s) tested
root@kali:~# 
```

**davtest**

Davtest is a command-line tool specifically designed for testing WebDAV configurations and security vulnerabilities. It focuses on identifying weaknesses related to the WebDAV protocol, such as unauthorized access, misconfigurations, and potential vulnerabilities in WebDAV-enabled servers. Davtest is commonly used by security professionals and penetration testers to assess the security of web servers and applications that support WebDAV functionality.

```bash
@kali:~# davtest -url http://10.2.2.100
********************************************************
 Testing DAV connection
OPEN		FAIL:	http://10.2.2.100	Operation failed. You can only open a collection (directory)

root@kali:~# davtest -url http://10.2.2.100/webdav
********************************************************
 Testing DAV connection
OPEN		FAIL:	http://10.2.2.100/webdav	Server response: 405 Method Not Allowed

root@kali:~# davtest -url http://10.2.2.100/davserver
********************************************************
 Testing DAV connection
OPEN		FAIL:	http://10.2.2.100/davserver	Server response: 405 Method Not Allowed
root@kali:~# 
```

Neither nikto nor davtest gave me the path for the webDAV folder on the server. But we're close. Let's try using OWASP-ZAP. 

## Using OWASP-ZAP to scan for vulnerabilities 

OWASP ZAP (Zed Attack Proxy) is an open-source security testing tool used for finding vulnerabilities in web applications during development and testing phases. It is designed to help identify and mitigate security risks, including cross-site scripting (XSS), SQL injection, and other common web application vulnerabilities. ZAP provides a user-friendly interface for manual testing as well as automation capabilities for running security scans and tests against web applications. It is a widely used tool among security professionals and developers to ensure the security and resilience of web applications against potential attacks.

Start OWASP-ZAP by going to Applications > 03 - Web Application Analysis > owasp-zap

Once the application is open, type in the target machine webserver address: `http://10.2.2.100` and click the `Attack`` button

![Alt text](image-5.png)

While the attack is happening, watch the left site Sites window, expand Sites, and look for the webDAV folder.

![Alt text](image-8.png)

Click the Request tab to view the GET request with the web address: 

![Alt text](image-9.png)

In this case, the webDAV folder appears to be `http://10.2.2.100/dav/`

Now we can try `davtest` again see if the target webserver is vulnerable to webDAV exploits

```bash
oot@kali:~# davtest -url http://10.2.2.100/dav
********************************************************
 Testing DAV connection
OPEN		SUCCEED:		http://10.2.2.100/dav
********************************************************
NOTE	Random string for this session: QzgIO5u
********************************************************
 Creating directory
MKCOL		SUCCEED:		Created http://10.2.2.100/dav/DavTestDir_QzgIO5u
********************************************************
 Sending test files
PUT	cfm	SUCCEED:	http://10.2.2.100/dav/DavTestDir_QzgIO5u/davtest_QzgIO5u.cfm
PUT	jsp	SUCCEED:	http://10.2.2.100/dav/DavTestDir_QzgIO5u/davtest_QzgIO5u.jsp
PUT	jhtml	SUCCEED:	http://10.2.2.100/dav/DavTestDir_QzgIO5u/davtest_QzgIO5u.jhtml
PUT	aspx	SUCCEED:	http://10.2.2.100/dav/DavTestDir_QzgIO5u/davtest_QzgIO5u.aspx
PUT	shtml	SUCCEED:	http://10.2.2.100/dav/DavTestDir_QzgIO5u/davtest_QzgIO5u.shtml
PUT	html	SUCCEED:	http://10.2.2.100/dav/DavTestDir_QzgIO5u/davtest_QzgIO5u.html
PUT	pl	SUCCEED:	http://10.2.2.100/dav/DavTestDir_QzgIO5u/davtest_QzgIO5u.pl
PUT	asp	SUCCEED:	http://10.2.2.100/dav/DavTestDir_QzgIO5u/davtest_QzgIO5u.asp
PUT	txt	SUCCEED:	http://10.2.2.100/dav/DavTestDir_QzgIO5u/davtest_QzgIO5u.txt
PUT	php	SUCCEED:	http://10.2.2.100/dav/DavTestDir_QzgIO5u/davtest_QzgIO5u.php
PUT	cgi	SUCCEED:	http://10.2.2.100/dav/DavTestDir_QzgIO5u/davtest_QzgIO5u.cgi
********************************************************
 Checking for test file execution
EXEC	cfm	FAIL
EXEC	jsp	FAIL
EXEC	jhtml	FAIL
EXEC	aspx	FAIL
EXEC	shtml	FAIL
EXEC	html	SUCCEED:	http://10.2.2.100/dav/DavTestDir_QzgIO5u/davtest_QzgIO5u.html
EXEC	pl	FAIL
EXEC	asp	FAIL
EXEC	txt	SUCCEED:	http://10.2.2.100/dav/DavTestDir_QzgIO5u/davtest_QzgIO5u.txt
EXEC	php	SUCCEED:	http://10.2.2.100/dav/DavTestDir_QzgIO5u/davtest_QzgIO5u.php
EXEC	cgi	FAIL

********************************************************
/usr/bin/davtest Summary:
Created: http://10.2.2.100/dav/DavTestDir_QzgIO5u
PUT File: http://10.2.2.100/dav/DavTestDir_QzgIO5u/davtest_QzgIO5u.cfm
PUT File: http://10.2.2.100/dav/DavTestDir_QzgIO5u/davtest_QzgIO5u.jsp
PUT File: http://10.2.2.100/dav/DavTestDir_QzgIO5u/davtest_QzgIO5u.jhtml
PUT File: http://10.2.2.100/dav/DavTestDir_QzgIO5u/davtest_QzgIO5u.aspx
PUT File: http://10.2.2.100/dav/DavTestDir_QzgIO5u/davtest_QzgIO5u.shtml
PUT File: http://10.2.2.100/dav/DavTestDir_QzgIO5u/davtest_QzgIO5u.html
PUT File: http://10.2.2.100/dav/DavTestDir_QzgIO5u/davtest_QzgIO5u.pl
PUT File: http://10.2.2.100/dav/DavTestDir_QzgIO5u/davtest_QzgIO5u.asp
PUT File: http://10.2.2.100/dav/DavTestDir_QzgIO5u/davtest_QzgIO5u.txt
PUT File: http://10.2.2.100/dav/DavTestDir_QzgIO5u/davtest_QzgIO5u.php
PUT File: http://10.2.2.100/dav/DavTestDir_QzgIO5u/davtest_QzgIO5u.cgi
Executes: http://10.2.2.100/dav/DavTestDir_QzgIO5u/davtest_QzgIO5u.html
Executes: http://10.2.2.100/dav/DavTestDir_QzgIO5u/davtest_QzgIO5u.txt
Executes: http://10.2.2.100/dav/DavTestDir_QzgIO5u/davtest_QzgIO5u.php

```

The output from the `davtest` command indicates the results of testing a WebDAV-enabled server at `http://10.2.2.100/dav`. Here's a summary of the findings:

1. **Testing DAV Connection**: The initial connection to the WebDAV server was successful.

2. **Creating Directory**: The tool successfully created a directory named "DavTestDir_QzgIO5u" on the server.

3. **Sending Test Files**: Test files with various extensions (e.g., .cfm, .jsp, .php) were successfully uploaded to the created directory.

4. **Checking for Test File Execution**:
   - The tool attempted to execute the uploaded files with various extensions (e.g., .cfm, .jsp, .php).
   - Execution attempts for several file types (e.g., .cfm, .jsp, .aspx) failed.
   - Execution attempts for .html, .txt, and .php files succeeded, and the URLs where they can be executed were provided in the output.

Overall, this `davtest` session indicates that the tested WebDAV server allows file uploads and the execution of certain file types, specifically .html, .txt, and .php files, which may have security implications depending on the server's configuration and purpose. Further assessment and security hardening may be necessary to address potential vulnerabilities.

Also be mindful of the trail and breadcrumbs left behind during Pentesting.  

davtest generates files during testing which will be visible on the target filesystem.

![Alt text](image-11.png)

The files created during the davtest will be visible on the webserver as well. 

![Alt text](image-13.png)

Tip: Use the cleanup flag. 

```bash
davtest -url http://10.2.2.100/dav -cleanup
```


![Alt text](image-14.png)
### Uploading files to the dav directory folder



### 